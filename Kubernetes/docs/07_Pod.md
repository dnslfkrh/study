# 파드 (Pod)
쿠버네티스에서 생성하고 관리할 수 있는 `배포 가능한` `가장 작은 컴퓨팅 단위`이다.

하나 이상의 컨테이너의 그룹이며, 스토리지 및 네트워크를 공유하고, 해당 컨테이너를 구동하는 방식에 대한 명세를 갖는다.

## 쿠버네티스 클러스터의 파드

### 단일 컨테이너에서 실행되는 파드:
파드 당 컨테이너 1개 모델: 가장 흔한 사용 사례. 쿠버네티스는 컨테이너를 관리하는게 아니라 파드를 관리한다.

### 여러 컨테이너를 실행하는 파드:
파드는 서로 긴밀하게 결합되어 자원을 공유해야 하는 여러 개의 컨테이너로 구성된 애플리케이션을 캡슐화 가능하다. 이렇게 관리되는 컨테이너들은 응집력있는 단위를 이룬다.

## 파드의 사용
일반적으로 파드는 직접 생성하지 않고 워크로드 리소스를 사용해 생성한다.

### Nginx 이미지 사용 예제

`pods/simple-pod.yaml`
```yaml
apiVersion1: v1
kind: Pod
metadata:
  name: nginx
spec:
  containers:
  - name: nginx
    image: nginx:1.14.2
    ports:
    - containerPort: 80
```

실행  
`
kubectl apply -f https://k8s.io/examples/pods/simple-pod.yaml
`

## 레플리케이션

각 파드는 특정 애플리케이션의 단일 인스턴스를 실행하기 위한 것이다. 더 많은 인스턴스를 실행해 더 많은 리소스를 제공하기 위해 애플리케이션을 수펴적으로 확장하기 위해선, 각 인스턴ㄴ스에 하나씩, 여러 파드를 사용해야 한다. 이를 `레플리케이션`이라고 한다.

## 파드 작업
사용자가 쿠버네티스에서 직접 개별 파드를 만드는 경우는 거의 없다. 싱글톤 파드도 마찬가지. 파드는 생성될 때 클러스터의 노드에서 생성되도록 스케줄된다. 파드는 실행이 완료되거나 축출되거나 노드가 실패할 때까지 노드에 남아 있는다.

## 파드 컨트롤러
파드 장애 시 복제 및 롤아웃과 자동 복구를 처리한다.

### 하나 이상의 파드를 관리하는 워크로드 리소스 예시
- 디플로이먼트
- 스테이트풀셋
- 데몬셋

## 파드 템플릿
워크로드 리소스에 대한 컨트롤러는 파드 템플릿에서 파드를 생성하고 사용자 대신 파드를 관리한다.
파드 템플릿은 `파드를 생성하기 위한 명세`이며, 디플로이먼트, 잡, 데몬셋과 같은 워크로드 리소스에 포함된다.

### 하나의 컨테이너를 실행하는 template이 있는 잡 예제

```yaml
apiVersion: batch/v1
kind: Job
metadata:
  name: hello
spec:
  template:
    # 여기부터 템플릿
    spec:
      containers:
      - name: hello
        image: hello:1.1.1
        command: ['sh', '-c', 'echo "Hello, Kubernetes!" && sleep 3600']
      restartPolicy: OnFailure
    # 여기까지 템플릿
```

파드 템플릿을 수정하거나 바꿔도 `이미 존재하는 파드`에는 영향을 주지 않는다.

## 리소스 공유와 통신
파드는 파드에 속한 컨테이너 간의 데이터 공유와 통신을 지원한다.

### 파드 스토리지
파드는 공유 스토리지 볼륨의 집할을 지정할 수 있다. 파드의 모든 컨테이너는 공유 볼륨에 접근 가능하니까 데이터 공유가 가능하다.

### 파드 네트워킹
각 파드에는 각 주소 패밀리에 대하 고유 IP가 할당된다. 파드의 모든 컨테이너는 네트워크 네임스페이스를 공유하며,여기에는 IP 주소와 네트워크 포트가 포함된다. 파드 내부에서 그 안에 있는 컨테이너들끼리는 `localhost`로 통신이 가능하다.

파드의 컨테이너가 외부 엔티티와 통신할 때, 공유 네트워크 리소스를 사용하는 방법을 조정해야 한다. 파드 내에서 컨테이너들은 IP와 포트 공간을 공유하며, `localhost`로 서로를 찾을 수 있다.

다른 파드의 컨테이너와 통신하려는 컨테이너는 `IP 네트워킹`을 써야 한다.